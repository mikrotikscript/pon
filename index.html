<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Redaman Jaringan PON Berantai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .header {
            background-color: #27ae60; /* Warna hijau dari screenshot */
        }
        .form-input, .form-select {
            @apply w-full px-4 py-3 bg-white border border-gray-300 rounded-md focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all;
        }
        .output-field {
            @apply w-full px-4 py-3 bg-gray-200 border border-gray-300 rounded-md text-gray-800 font-bold text-lg text-center;
        }
        .btn-primary {
            @apply w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 text-lg;
        }
        .btn-secondary {
            @apply px-4 py-2 bg-gray-600 text-white font-semibold text-sm rounded-md hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-lg bg-white rounded-lg shadow-md overflow-hidden">
        <header class="header p-4">
            <h1 class="text-xl font-bold text-white">Pon Calculator</h1>
        </header>

        <main class="p-6 space-y-5">
            <div>
                <label for="inputLaser" class="block text-sm font-medium text-gray-700 mb-1">Input Laser</label>
                <input type="number" step="0.1" id="inputLaser" class="form-input" value="8">
            </div>

            <div>
                <label for="splitterRatio" class="block text-sm font-medium text-gray-700 mb-1">Splitter Ratio</label>
                <select id="splitterRatio" class="form-select"></select>
            </div>

            <div>
                <label for="splitterPlc" class="block text-sm font-medium text-gray-700 mb-1">Splitter PLC</label>
                <select id="splitterPlc" class="form-select">
                    <option value="1:2">1:2</option>
                    <option value="1:4">1:4</option>
                    <option value="1:8" selected>1:8</option>
                    <option value="1:16">1:16</option>
                    <option value="1:32">1:32</option>
                    <option value="1:64">1:64</option>
                </select>
            </div>

            <div class="pt-4">
                <button id="calculateBtn" class="btn-primary">Hitung</button>
            </div>

            <div class="pt-4 space-y-4">
                 <div>
                    <label for="outputLaser" class="block text-sm font-medium text-gray-700 mb-1 text-center">Output Laser (ke Pelanggan)</label>
                    <input type="text" id="outputLaser" class="output-field" readonly>
                </div>
                <div>
                    <label for="nextOdp" class="block text-sm font-medium text-gray-700 mb-1 text-center">Next ODP (Power Lanjutan)</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="nextOdp" class="output-field flex-grow" readonly>
                        <button type="button" id="useNextOdpBtn" class="btn-secondary">Gunakan</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Data redaman (insertion loss) standar industri dalam dB
            const ratioLosses = {
                'none':   { tap: 0,    through: 0 },
                '1/99':   { tap: 20.4, through: 0.2 }, '2/98':   { tap: 17.4, through: 0.3 },
                '3/97':   { tap: 15.6, through: 0.3 }, '4/96':   { tap: 14.4, through: 0.4 },
                '5/95':   { tap: 13.5, through: 0.4 }, '6/94':   { tap: 12.6, through: 0.5 },
                '7/93':   { tap: 11.9, through: 0.5 }, '8/92':   { tap: 11.3, through: 0.6 },
                '9/91':   { tap: 10.8, through: 0.6 }, '10/90':  { tap: 10.2, through: 0.7 },
                '15/85':  { tap: 8.5,  through: 0.9 }, '20/80':  { tap: 7.3,  through: 1.2 },
                '25/75':  { tap: 6.4,  through: 1.5 }, '30/70':  { tap: 5.5,  through: 1.8 },
                '35/65':  { tap: 4.8,  through: 2.1 }, '40/60':  { tap: 4.2,  through: 2.5 },
                '45/55':  { tap: 3.8,  through: 2.9 }, '50/50':  { tap: 3.4,  through: 3.4 }
            };
            const plcLosses = {
                '1:2': 3.4, '1:4': 7.4, '1:8': 10.5,
                '1:16': 13.8, '1:32': 17.2, '1:64': 20.7
            };

            const calculateBtn = document.getElementById('calculateBtn');
            const splitterRatioEl = document.getElementById('splitterRatio');
            const useNextOdpBtn = document.getElementById('useNextOdpBtn');

            // Fungsi untuk mengisi pilihan Splitter Ratio
            function populateRatioOptions() {
                const options = { "none": "Tanpa Ratio", "1/99": "01:99", "2/98": "02:98", "3/97": "03:97", "4/96": "04:96", "5/95": "05:95", "6/94": "06:94", "7/93": "07:93", "8/92": "08:92", "9/91": "09:91", "10/90": "10:90", "15/85": "15:85", "20/80": "20:80", "25/75": "25:75", "30/70": "30:70", "35/65": "35:65", "40/60": "40:60", "45/55": "45:55", "50/50": "50:50" };
                for (const [value, text] of Object.entries(options)) {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = text;
                    splitterRatioEl.appendChild(option);
                }
                splitterRatioEl.value = '1/99';
            }

            // Fungsi utama untuk kalkulasi
            function calculate() {
                const inputLaserEl = document.getElementById('inputLaser');
                const splitterPlcEl = document.getElementById('splitterPlc');
                const outputLaserEl = document.getElementById('outputLaser');
                const nextOdpEl = document.getElementById('nextOdp');

                const inputPower = parseFloat(inputLaserEl.value);
                if (isNaN(inputPower)) {
                    alert('Mohon masukkan nilai Input Laser yang valid.');
                    return;
                }

                const selectedRatio = splitterRatioEl.value;
                const selectedPlc = splitterPlcEl.value;
                const ratioLoss = ratioLosses[selectedRatio];
                const plcLoss = plcLosses[selectedPlc];

                let powerToNextOdp, finalOutputPower;

                if (selectedRatio === 'none') {
                    powerToNextOdp = "N/A";
                    finalOutputPower = inputPower - plcLoss;
                    nextOdpEl.value = powerToNextOdp;
                    useNextOdpBtn.disabled = true; // Nonaktifkan tombol
                } else {
                    powerToNextOdp = inputPower - ratioLoss.through;
                    const powerToPlc = inputPower - ratioLoss.tap;
                    finalOutputPower = powerToPlc - plcLoss;
                    nextOdpEl.value = `${powerToNextOdp.toFixed(2)} dBm`;
                    useNextOdpBtn.disabled = false; // Aktifkan tombol
                }
                outputLaserEl.value = `${finalOutputPower.toFixed(2)} dBm`;
            }
            
            // --- FUNGSI BARU: Gunakan sisa power untuk input selanjutnya ---
            function useNextOdpPower() {
                const nextOdpEl = document.getElementById('nextOdp');
                const inputLaserEl = document.getElementById('inputLaser');
                
                // Ambil hanya angka dari string (contoh: "5.65 dBm" -> 5.65)
                const powerValue = parseFloat(nextOdpEl.value);

                if (!isNaN(powerValue)) {
                    inputLaserEl.value = powerValue.toFixed(2);
                    // Hitung ulang secara otomatis setelah nilai baru dimasukkan
                    calculate();
                }
            }

            // Menjalankan fungsi dan event listener
            populateRatioOptions();
            calculateBtn.addEventListener('click', calculate);
            useNextOdpBtn.addEventListener('click', useNextOdpPower);
            
            // Lakukan perhitungan awal saat halaman dimuat
            calculate();
        });
    </script>

</body>
</html>

